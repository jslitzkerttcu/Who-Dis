{% extends "base.html" %}

{% block title %}Configuration Management - Who Dis?{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto">
    <div class="flex justify-between items-center mb-6">
        <h1 class="text-3xl font-bold text-gray-900 flex items-center">
            <i class="fas fa-sliders-h mr-3"></i>
            Configuration Management
        </h1>
        <a href="{{ url_for('admin.index') }}" 
           class="px-4 py-2 bg-gray-200 hover:bg-gray-300 text-gray-700 font-medium rounded-lg transition duration-150 ease-in-out flex items-center">
            <i class="fas fa-arrow-left mr-2"></i>
            Back to Admin
        </a>
    </div>

    <!-- Navigation Tabs -->
    <div class="border-b border-gray-200 mb-6">
        <nav class="-mb-px flex space-x-8" aria-label="Tabs">
            <button class="tab-button active" data-tab="app">
                <i class="fas fa-cog mr-2"></i>
                Application
            </button>
            <button class="tab-button" data-tab="ldap">
                <i class="fas fa-network-wired mr-2"></i>
                LDAP
            </button>
            <button class="tab-button" data-tab="azure">
                <i class="fab fa-microsoft mr-2"></i>
                Azure AD
            </button>
            <button class="tab-button" data-tab="genesys">
                <i class="fas fa-headset mr-2"></i>
                Genesys
            </button>
            <button class="tab-button" data-tab="data-warehouse">
                <i class="fas fa-database mr-2"></i>
                Data Warehouse
            </button>
        </nav>
    </div>

    <!-- Tab Content -->
    <div class="tab-content">
        <!-- Application Tab -->
        <div id="app-tab-content" class="tab-pane active">
            <div class="bg-white rounded-lg shadow-md border border-gray-200">
                <div class="bg-ttcu-green text-white px-6 py-4 rounded-t-lg">
                    <h5 class="text-lg font-semibold flex items-center">
                        <i class="fas fa-cog mr-2"></i>
                        Application Settings
                    </h5>
                </div>
                <div class="p-6" hx-get="{{ url_for('admin.api_configuration') }}?section=app" 
                     hx-trigger="load" 
                     hx-swap="innerHTML">
                    <div class="text-center py-8">
                        <div class="inline-flex items-center">
                            <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-ttcu-green mr-3"></div>
                            <span class="text-gray-600">Loading configuration...</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- LDAP Tab -->
        <div id="ldap-tab-content" class="tab-pane hidden">
            <div class="bg-white rounded-lg shadow-md border border-gray-200">
                <div class="bg-green-600 text-white px-6 py-4 rounded-t-lg flex justify-between items-center">
                    <h5 class="text-lg font-semibold flex items-center">
                        <i class="fas fa-network-wired mr-2"></i>
                        LDAP Configuration
                    </h5>
                    <button class="px-4 py-2 bg-green-500 hover:bg-green-400 text-white text-sm rounded-md transition duration-150"
                            hx-get="{{ url_for('admin.test_ldap_connection') }}"
                            hx-target="#ldap-test-result"
                            hx-indicator="#ldap-test-spinner">
                        <i class="fas fa-plug mr-1"></i>
                        Test Connection
                        <span id="ldap-test-spinner" class="htmx-indicator ml-2">
                            <i class="fas fa-spinner fa-spin"></i>
                        </span>
                    </button>
                </div>
                <div id="ldap-test-result" class="hidden"></div>
                <div class="p-6" hx-get="{{ url_for('admin.api_configuration') }}?section=ldap" 
                     hx-trigger="load" 
                     hx-swap="innerHTML">
                    <div class="text-center py-8">
                        <div class="inline-flex items-center">
                            <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-green-600 mr-3"></div>
                            <span class="text-gray-600">Loading configuration...</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Azure AD Tab -->
        <div id="azure-tab-content" class="tab-pane hidden">
            <div class="bg-white rounded-lg shadow-md border border-gray-200">
                <div class="bg-blue-600 text-white px-6 py-4 rounded-t-lg flex justify-between items-center">
                    <h5 class="text-lg font-semibold flex items-center">
                        <i class="fab fa-microsoft mr-2"></i>
                        Azure AD / Microsoft Graph Configuration
                    </h5>
                    <button class="px-4 py-2 bg-blue-500 hover:bg-blue-400 text-white text-sm rounded-md transition duration-150"
                            hx-get="{{ url_for('admin.test_graph_connection') }}"
                            hx-target="#graph-test-result"
                            hx-indicator="#graph-test-spinner">
                        <i class="fas fa-plug mr-1"></i>
                        Test Connection
                        <span id="graph-test-spinner" class="htmx-indicator ml-2">
                            <i class="fas fa-spinner fa-spin"></i>
                        </span>
                    </button>
                </div>
                <div id="graph-test-result" class="hidden"></div>
                <div class="p-6" hx-get="{{ url_for('admin.api_configuration') }}?section=graph" 
                     hx-trigger="load" 
                     hx-swap="innerHTML">
                    <div class="text-center py-8">
                        <div class="inline-flex items-center">
                            <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mr-3"></div>
                            <span class="text-gray-600">Loading configuration...</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Genesys Tab -->
        <div id="genesys-tab-content" class="tab-pane hidden">
            <div class="bg-white rounded-lg shadow-md border border-gray-200">
                <div class="bg-genesys-orange text-white px-6 py-4 rounded-t-lg flex justify-between items-center">
                    <h5 class="text-lg font-semibold flex items-center">
                        <i class="fas fa-headset mr-2"></i>
                        Genesys Cloud Configuration
                    </h5>
                    <button class="px-4 py-2 bg-orange-500 hover:bg-orange-400 text-white text-sm rounded-md transition duration-150"
                            hx-get="{{ url_for('admin.test_genesys_connection') }}"
                            hx-target="#genesys-test-result"
                            hx-indicator="#genesys-test-spinner">
                        <i class="fas fa-plug mr-1"></i>
                        Test Connection
                        <span id="genesys-test-spinner" class="htmx-indicator ml-2">
                            <i class="fas fa-spinner fa-spin"></i>
                        </span>
                    </button>
                </div>
                <div id="genesys-test-result" class="hidden"></div>
                <div class="p-6" hx-get="{{ url_for('admin.api_configuration') }}?section=genesys" 
                     hx-trigger="load" 
                     hx-swap="innerHTML">
                    <div class="text-center py-8">
                        <div class="inline-flex items-center">
                            <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-genesys-orange mr-3"></div>
                            <span class="text-gray-600">Loading configuration...</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Data Warehouse Tab -->
        <div id="data-warehouse-tab-content" class="tab-pane hidden">
            <div class="bg-white rounded-lg shadow-md border border-gray-200">
                <div class="bg-purple-600 text-white px-6 py-4 rounded-t-lg flex justify-between items-center">
                    <h5 class="text-lg font-semibold flex items-center">
                        <i class="fas fa-database mr-2"></i>
                        Data Warehouse Configuration
                    </h5>
                    <button class="px-4 py-2 bg-purple-500 hover:bg-purple-400 text-white text-sm rounded-md transition duration-150"
                            hx-get="{{ url_for('admin.test_data_warehouse_connection') }}"
                            hx-target="#dw-test-result"
                            hx-indicator="#dw-test-spinner">
                        <i class="fas fa-plug mr-1"></i>
                        Test Connection
                        <span id="dw-test-spinner" class="htmx-indicator ml-2">
                            <i class="fas fa-spinner fa-spin"></i>
                        </span>
                    </button>
                </div>
                <div id="dw-test-result" class="hidden"></div>
                <div class="p-6" hx-get="{{ url_for('admin.api_configuration') }}?section=data_warehouse" 
                     hx-trigger="load" 
                     hx-swap="innerHTML">
                    <div class="text-center py-8">
                        <div class="inline-flex items-center">
                            <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-purple-600 mr-3"></div>
                            <span class="text-gray-600">Loading configuration...</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    .tab-button {
        @apply whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm transition-colors duration-150 cursor-pointer;
        @apply border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300;
    }
    .tab-button.active {
        @apply border-ttcu-green text-ttcu-green;
    }
    .tab-pane {
        display: none;
    }
    .tab-pane.active {
        display: block;
    }
    .htmx-indicator {
        display: none;
    }
    .htmx-request .htmx-indicator {
        display: inline-block;
    }
    .htmx-request.htmx-indicator {
        display: inline-block;
    }
</style>

<script>
    // Tab switching
    document.addEventListener('DOMContentLoaded', function() {
        const tabButtons = document.querySelectorAll('.tab-button');
        const tabPanes = document.querySelectorAll('.tab-pane');
        
        tabButtons.forEach(button => {
            button.addEventListener('click', function() {
                const targetTab = this.getAttribute('data-tab');
                
                // Update button states
                tabButtons.forEach(btn => btn.classList.remove('active'));
                this.classList.add('active');
                
                // Update pane visibility
                tabPanes.forEach(pane => pane.classList.remove('active'));
                document.getElementById(targetTab + '-tab-content').classList.add('active');
            });
        });
    });
    
    // Handle test result display
    document.body.addEventListener('htmx:afterSwap', function(evt) {
        if (evt.detail.target.id.endsWith('-test-result')) {
            evt.detail.target.classList.remove('hidden');
            // Auto-hide success messages after 5 seconds
            if (evt.detail.target.querySelector('.bg-green-50')) {
                setTimeout(() => {
                    evt.detail.target.classList.add('hidden');
                }, 5000);
            }
        }
    });
    
    // Handle configuration saves
    document.body.addEventListener('htmx:afterRequest', function(evt) {
        if (evt.detail.successful && evt.detail.elt.hasAttribute('hx-post') && evt.detail.pathInfo.requestPath.includes('configuration')) {
            // Show success message
            const msg = document.createElement('div');
            msg.className = 'fixed top-4 right-4 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg z-50';
            msg.innerHTML = '<i class="fas fa-check-circle mr-2"></i>Configuration saved successfully';
            document.body.appendChild(msg);
            setTimeout(() => msg.remove(), 3000);
        }
    });
</script>
{% endblock %}